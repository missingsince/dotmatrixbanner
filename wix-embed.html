<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Matrix Banner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #444;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        .led-matrix-container {
            background: #000000;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            border: 2px solid #0a0a0a;
        }

        #ledMatrix {
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            box-shadow: 0px 6px 28px rgba(0, 0, 0, 0.8);
        }

        .message-form {
            width: 100%;
            margin-top: 15px;
            background: #000000;
            border: 1px solid #222222;
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            border-radius: 4px;
        }

        .message-form input[type="text"] {
            padding: 10px 15px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: 250px;
            outline: none;
        }

        .message-form input[type="text"]:focus {
            border-color: #333333;
        }

        .message-form input[type="text"]::placeholder {
            color: #888888;
        }

        .message-form button {
            padding: 10px 20px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }

        .message-form button:hover {
            background: #1a1a1a;
            border-color: #2a2a2a;
        }

        .message-form button:active {
            background: #050505;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }

            .led-matrix-container {
                padding: 10px;
                max-width: 100%;
            }

            #ledMatrix {
                max-width: 100%;
                height: auto;
            }

            .message-form {
                gap: 8px;
                padding: 12px;
            }

            .message-form input[type="text"] {
                flex: 1;
                min-width: 0;
            }

            .message-form button {
                flex-shrink: 0;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 15px 5px;
            }

            .led-matrix-container {
                padding: 5px;
            }

            .message-form {
                padding: 10px;
            }

            .message-form input[type="text"] {
                font-size: 16px;
            }

            .message-form button {
                padding: 12px 20px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="led-matrix-container">
        <canvas id="ledMatrix"></canvas>
    </div>
    <div class="message-form">
        <input type="text" id="messageInput" placeholder="Send a message..." maxlength="100">
        <button id="updateBtn">Send</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase configuration
        const SUPABASE_CONFIG = {
            url: 'https://heszpknggzifbxrlcrwc.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhlc3pwa25nZ3ppZmJ4cmxjcndjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNjUyODIsImV4cCI6MjA3OTg0MTI4Mn0.vzCjauh8RfE16bBX4nByhjQROcaYsZymruh1IIb0xAU'
        };

        class LEDMatrix {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');

                // dotSize and dotSpacing calculated in initCanvas()
                this.charWidth = 6;
                this.charHeight = 7;
                this.charSpacing = 1;

                this.scrollPosition = 0;
                this.scrollSpeed = 2;
                this.isPaused = false;
                this.inverted = false;

                this.message = 'GROUND RULES 2026';
                this.actualMessage = 'GROUND RULES 2026';
                this.introFrame = 0;
                this.showingIntro = true;
                this.color = 'amber';
                this.colors = {
                    red: { on: '#ff0000', off: '#222' },
                    green: { on: '#1e4', off: '#222' },
                    amber: { on: '#ffbf00', off: '#222' },
                    blue: { on: '#0080ff', off: '#222' },
                    white: { on: '#ffffff', off: '#222' }
                };

                this.initCanvas();
                this.loadFont();
                this.animate();
            }

            initCanvas() {
                // Account for body padding (40px) and container padding (varies by screen size)
                const containerPadding = window.innerWidth <= 480 ? 10 : (window.innerWidth <= 768 ? 20 : 40);
                const maxWidth = window.innerWidth - containerPadding;

                // Calculate dotSpacing to ensure "GROUND RULES" (12 chars) always fits
                // 12 chars * (6 char width + 1 spacing) = 84 dots needed
                const requiredDots = 84;
                const calculatedSpacing = maxWidth / requiredDots;

                // Cap at 28px for large screens, but allow smaller for mobile
                this.dotSpacing = Math.min(calculatedSpacing, 28);

                // Make dotSize proportional to dotSpacing (roughly 78% of spacing)
                this.dotSize = this.dotSpacing * 0.78;

                const cols = Math.floor(maxWidth / this.dotSpacing);
                const rows = this.charHeight;

                this.canvas.width = cols * this.dotSpacing;
                this.canvas.height = rows * this.dotSpacing;

                this.canvas.style.width = this.canvas.width + 'px';
                this.canvas.style.height = this.canvas.height + 'px';

                window.addEventListener('resize', () => {
                    const newContainerPadding = window.innerWidth <= 480 ? 10 : (window.innerWidth <= 768 ? 20 : 40);
                    const newMaxWidth = window.innerWidth - newContainerPadding;
                    const newCalculatedSpacing = newMaxWidth / requiredDots;
                    this.dotSpacing = Math.min(newCalculatedSpacing, 28);
                    this.dotSize = this.dotSpacing * 0.78;

                    const newCols = Math.floor(newMaxWidth / this.dotSpacing);

                    this.canvas.width = newCols * this.dotSpacing;
                    this.canvas.style.width = this.canvas.width + 'px';
                    this.canvas.height = rows * this.dotSpacing;
                    this.canvas.style.height = this.canvas.height + 'px';
                });
            }

            loadFont() {
                this.font = {
                    'A': [[0,1,1,1,0],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
                    'B': [[1,1,1,1,0],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],
                    'C': [[0,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[0,1,1,1,1]],
                    'D': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0]],
                    'E': [[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],
                    'F': [[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],
                    'G': [[0,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    'H': [[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
                    'I': [[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1]],
                    'J': [[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    'K': [[1,0,0,0,1],[1,0,0,1,0],[1,1,1,0,0],[1,0,0,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
                    'L': [[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],
                    'M': [[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1]],
                    'N': [[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[1,0,0,0,1]],
                    'O': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    'P': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],
                    'Q': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,1,0],[0,1,1,0,1]],
                    'R': [[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,0],[1,0,0,1,0],[1,0,0,0,1],[1,0,0,0,1]],
                    'S': [[0,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,1,1,1,0]],
                    'T': [[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],
                    'U': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    'V': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0]],
                    'W': [[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0]],
                    'X': [[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[1,0,0,0,1]],
                    'Y': [[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0]],
                    'Z': [[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0],[1,1,1,1,1]],
                    '0': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,1,1],[1,0,1,0,1],[1,1,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    '1': [[0,0,1,0,0],[0,1,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,1,1,1,0]],
                    '2': [[0,1,1,1,0],[1,0,0,0,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,1,1,1,1]],
                    '3': [[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,1,0],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    '4': [[1,0,0,0,0],[1,0,0,1,0],[1,0,0,1,0],[1,0,0,1,0],[1,1,1,1,1],[0,0,0,1,0],[0,0,0,1,0]],
                    '5': [[1,1,1,1,1],[1,0,0,0,0],[1,1,1,1,0],[0,0,0,0,1],[0,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    '6': [[0,1,1,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    '7': [[1,1,1,1,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0]],
                    '8': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,0]],
                    '9': [[0,1,1,1,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,1,1,1],[0,0,0,0,1],[0,0,0,0,1],[1,1,1,1,0]],
                    ' ': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],
                    '-': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],
                    '!': [[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],
                    '?': [[0,1,1,1,0],[1,0,0,0,1],[0,0,0,0,1],[0,0,1,1,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0]],
                    '.': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0]],
                    ',': [[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,1,0,0,0]],
                    ':': [[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0]],
                    ';': [[0,0,0,0,0],[0,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,1,0,0,0]],
                    '/': [[0,0,0,0,1],[0,0,0,0,1],[0,0,0,1,0],[0,0,1,0,0],[0,1,0,0,0],[1,0,0,0,0],[1,0,0,0,0]],
                    '(': [[0,0,1,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,1,0,0,0],[0,0,1,0,0]],
                    ')': [[0,0,1,0,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,0,1,0],[0,0,1,0,0]],
                    '\'': [[0,1,0,0,0],[0,1,0,0,0],[1,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],
                    '"': [[1,0,1,0,0],[1,0,1,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]
                };
            }

            drawDot(x, y, isOn) {
                const colorScheme = this.colors[this.color];
                const dotColor = isOn ? colorScheme.on : colorScheme.off;

                this.ctx.fillStyle = dotColor;

                if (isOn) {
                    this.ctx.shadowColor = colorScheme.on;
                    this.ctx.shadowBlur = this.dotSize + 5;
                    this.ctx.shadowOffsetX = 0;
                    this.ctx.shadowOffsetY = 0;
                }

                this.ctx.beginPath();
                this.ctx.arc(x, y, this.dotSize / 2, 0, Math.PI * 2);
                this.ctx.fill();

                if (isOn) {
                    this.ctx.shadowBlur = 0;
                }
            }

            getCharPattern(char) {
                const upperChar = char.toUpperCase();
                return this.font[upperChar] || this.font['?'];
            }

            render() {
                this.ctx.fillStyle = '#0a0a0a';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                const cols = Math.floor(this.canvas.width / this.dotSpacing);
                const rows = this.charHeight;

                // Handle intro animation
                if (this.showingIntro) {
                    // Flash inverted every 10 frames (less aggressive)
                    if (this.introFrame % 10 === 0) {
                        this.inverted = !this.inverted;
                    }

                    // Draw background grid
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < cols; col++) {
                            const dotX = col * this.dotSpacing + (this.dotSpacing / 2);
                            const dotY = row * this.dotSpacing + (this.dotSpacing / 2);
                            this.drawDot(dotX, dotY, this.inverted);
                        }
                    }

                    // Display intro text based on frame
                    let introText;
                    if (this.introFrame < 50) {
                        introText = 'GROUND RULES';
                    } else if (this.introFrame < 100) {
                        introText = 'DEAN PARK';
                    } else {
                        introText = '19-21 JUNE 2026';
                    }

                    const introCharSpacing = 0; // Tighter spacing for intro
                    const textWidth = introText.length * (this.charWidth + introCharSpacing) * this.dotSpacing;
                    const startX = Math.floor((this.canvas.width - textWidth) / 2);

                    let currentX = startX;

                    for (let i = 0; i < introText.length; i++) {
                        const char = introText[i];
                        const pattern = this.getCharPattern(char);

                        for (let row = 0; row < this.charHeight; row++) {
                            for (let col = 0; col < pattern[row].length; col++) {
                                const dotX = currentX + (col * this.dotSpacing);
                                const dotY = (row * this.dotSpacing) + (this.dotSpacing / 2);

                                if (pattern[row][col] === 1) {
                                    this.drawDot(dotX, dotY, !this.inverted);
                                }
                            }
                        }

                        currentX += (this.charWidth + introCharSpacing) * this.dotSpacing;
                    }

                    this.introFrame++;

                    // After 150 frames (50 for each text), switch to actual message
                    if (this.introFrame >= 150) {
                        this.showingIntro = false;
                        this.inverted = false;
                        this.message = this.actualMessage;
                        this.scrollPosition = 0;
                    }
                } else {
                    // Normal scrolling message display
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < cols; col++) {
                            const dotX = col * this.dotSpacing + (this.dotSpacing / 2);
                            const dotY = row * this.dotSpacing + (this.dotSpacing / 2);
                            this.drawDot(dotX, dotY, this.inverted);
                        }
                    }

                    const totalWidth = this.message.length * (this.charWidth + this.charSpacing);
                    const startX = Math.floor(this.canvas.width + this.scrollPosition);

                    let currentX = startX;

                    for (let i = 0; i < this.message.length; i++) {
                        const char = this.message[i];
                        const pattern = this.getCharPattern(char);

                        for (let row = 0; row < this.charHeight; row++) {
                            for (let col = 0; col < pattern[row].length; col++) {
                                const dotX = currentX + (col * this.dotSpacing);
                                const dotY = (row * this.dotSpacing) + (this.dotSpacing / 2);

                                if (dotX >= -this.dotSpacing && dotX <= this.canvas.width + this.dotSpacing && pattern[row][col] === 1) {
                                    this.drawDot(dotX, dotY, !this.inverted);
                                }
                            }
                        }

                        currentX += (this.charWidth + this.charSpacing) * this.dotSpacing;
                    }

                    if (!this.isPaused) {
                        this.scrollPosition -= this.scrollSpeed;

                        if (this.scrollPosition < -(totalWidth * this.dotSpacing + this.canvas.width)) {
                            this.scrollPosition = 0;
                        }
                    }
                }
            }

            animate() {
                this.render();
                requestAnimationFrame(() => this.animate());
            }

            setMessage(message) {
                this.actualMessage = message.toUpperCase() || 'GROUND RULES 2026';
                this.showingIntro = true;
                this.introFrame = 0;
                this.inverted = false;
                this.scrollPosition = 0;
            }

            setSpeed(speed) {
                this.scrollSpeed = speed / 2.5;
            }

            setColor(color) {
                this.color = color;
            }

            pause() {
                this.isPaused = !this.isPaused;
            }

            reset() {
                this.scrollPosition = 0;
            }

            toggleInvert() {
                this.inverted = !this.inverted;
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const matrix = new LEDMatrix('ledMatrix');

            const messageInput = document.getElementById('messageInput');
            const updateBtn = document.getElementById('updateBtn');

            let supabaseClient = null;
            let realtimeChannel = null;

            if (window.SUPABASE_CONFIG && window.supabase) {
                const { url, anonKey } = SUPABASE_CONFIG;

                if (url !== 'YOUR_SUPABASE_URL' && anonKey !== 'YOUR_SUPABASE_ANON_KEY') {
                    const { createClient } = window.supabase;
                    supabaseClient = createClient(url, anonKey);

                    console.log('Connected to Supabase');

                    const { data, error } = await supabaseClient
                        .from('messages')
                        .select('*')
                        .order('created_at', { ascending: false })
                        .limit(1);

                    if (data && data.length > 0) {
                        matrix.setMessage(data[0].text);
                    }

                    realtimeChannel = supabaseClient
                        .channel('messages-channel')
                        .on('postgres_changes', {
                            event: '*',
                            schema: 'public',
                            table: 'messages'
                        }, (payload) => {
                            console.log('Realtime update:', payload);
                            if (payload.new && payload.new.text) {
                                matrix.setMessage(payload.new.text);
                            }
                        })
                        .subscribe((status) => {
                            console.log('Realtime subscription status:', status);
                        });
                }
            }

            updateBtn.addEventListener('click', async () => {
                const message = messageInput.value.trim();
                if (message && supabaseClient) {
                    const { error } = await supabaseClient
                        .from('messages')
                        .insert([{ text: message }]);

                    if (error) {
                        console.error('Error inserting message:', error);
                    } else {
                        messageInput.value = '';
                    }
                }
            });

            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    updateBtn.click();
                }
            });
        });
    </script>
</body>
</html>
